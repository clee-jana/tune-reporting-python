\hypertarget{example_cohort_8py-example}{\section{example\-\_\-cohort.\-py}
}
/advertiser/stats/ltv Tune Management A\-P\-I controller 'advertiser/stats/ltv'


\begin{DoxyCodeInclude}
1 \textcolor{comment}{#!/usr/bin/env python}
2 \textcolor{comment}{# -*- coding: utf-8 -*-}
3 \textcolor{comment}{#}
4 \textcolor{comment}{## example\_cohort.py}
5 \textcolor{comment}{#}
6 \textcolor{comment}{#  Copyright (c) 2014 Tune, Inc}
7 \textcolor{comment}{#  All rights reserved.}
8 \textcolor{comment}{#}
9 \textcolor{comment}{#  Permission is hereby granted, free of charge, to any person obtaining}
10 \textcolor{comment}{#  a copy of this software and associated documentation files}
11 \textcolor{comment}{#  (the "Software"), to deal in the Software without restriction, including}
12 \textcolor{comment}{#  without limitation the rights to use, copy, modify, merge, publish,}
13 \textcolor{comment}{#  distribute, sublicense, and/or sell copies of the Software, and to permit}
14 \textcolor{comment}{#  persons to whom the Software is furnished to do so, subject to the}
15 \textcolor{comment}{#  following conditions:}
16 \textcolor{comment}{#}
17 \textcolor{comment}{#  The above copyright notice and this permission notice shall be included in}
18 \textcolor{comment}{#  all copies or substantial portions of the Software.}
19 \textcolor{comment}{#}
20 \textcolor{comment}{#  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR}
21 \textcolor{comment}{#  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,}
22 \textcolor{comment}{#  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL}
23 \textcolor{comment}{#  THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER}
24 \textcolor{comment}{#  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING}
25 \textcolor{comment}{#  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER}
26 \textcolor{comment}{#  DEALINGS IN THE SOFTWARE.}
27 \textcolor{comment}{#}
28 \textcolor{comment}{#  Python 3.0}
29 \textcolor{comment}{#}
30 \textcolor{comment}{#  @category  Tune}
31 \textcolor{comment}{#  @package   Tune\_PHP\_SDK}
32 \textcolor{comment}{#  @author    Jeff Tanner <jefft@tune.com>}
33 \textcolor{comment}{#  @copyright 2014 Tune (http://www.tune.com)}
34 \textcolor{comment}{#  @license   http://opensource.org/licenses/MIT The MIT License (MIT)}
35 \textcolor{comment}{#  @version   0.9.1}
36 \textcolor{comment}{#  @link      https://developers.mobileapptracking.com Tune Developer Community @endlink}
37 \textcolor{comment}{#}
38 \textcolor{comment}{#  Cohort Report}
39 \textcolor{comment}{#}
40 \textcolor{comment}{#  For insight into the value of the users youâ€™ve acquired for your mobile app}
41 \textcolor{comment}{#  (e.g. how acquired users are performing over time), you can use our Cohort Report.}
42 \textcolor{comment}{#}
43 \textcolor{comment}{#  The cohort report analyzes user behavior back to click date time (Cohort by Click)}
44 \textcolor{comment}{#  or to install date time (Cohort by Install). Based on whether you are viewing}
45 \textcolor{comment}{#  the results based on click or install, the data in the report is vastly different.}
46 \textcolor{comment}{#}
47 \textcolor{comment}{#  Aggregate "cumulative" shows the data compounds or grows over time.}
48 \textcolor{comment}{#}
49 \textcolor{comment}{#  Aggregate "incremental" shows the rate of change over time.}
50 \textcolor{comment}{#}
51 \textcolor{comment}{#  Aggregate "cumulative" shows user growth over time by taking into account}
52 \textcolor{comment}{#  all of the revenue from the cohort date time to the specified time interval.}
53 \textcolor{comment}{#  Because the data is cumulative (values added on top of each other), the graph}
54 \textcolor{comment}{#  shows an upward trend as shown in the following screenshot.}
55 \textcolor{comment}{#}
56 \textcolor{comment}{#  Aggregate "incremental" option only includes the data measured during the specified}
57 \textcolor{comment}{#  interval (such as Day, Week, Month, Year, or All Time). Viewing the data}
58 \textcolor{comment}{#  incrementally does not appear as impressive as viewing cumulative or aggregated}
59 \textcolor{comment}{#  data because it only shows incremental changes (and there is typically a}
60 \textcolor{comment}{#  downward trend because of decreases in retention).}
61 \textcolor{comment}{#}
62 \textcolor{comment}{#  Cohort "clicks" refers to the number of clicks through to the app store to}
63 \textcolor{comment}{#  download an app.}
64 \textcolor{comment}{#}
65 \textcolor{comment}{#  Cohort "installs" refers to the number of downloads of an app}
66 \textcolor{comment}{#}
67 
68 \textcolor{keyword}{import} sys
69 \textcolor{keyword}{import} traceback
70 \textcolor{keyword}{import} datetime
71 
72 \textcolor{keyword}{from} \hyperlink{namespacetune_1_1management_1_1api_1_1advertiser_1_1stats}{tune.management.api.advertiser.stats} \textcolor{keyword}{import} LTV
73 \textcolor{keyword}{from} \hyperlink{namespacetune_1_1common}{tune.common} \textcolor{keyword}{import} (TuneSdkException, TuneServiceException)
74 
75 \textcolor{comment}{##}
76 \textcolor{comment}{# Example using Tune Management API client.}
77 \textcolor{keyword}{class }ExampleCohort(\hyperlink{classobject}{object}):
78 
79     \textcolor{keyword}{def }\_\_init\_\_(self):
80         \textcolor{keywordflow}{pass}
81 
82     \textcolor{comment}{#}
83     \textcolor{comment}{# Example of running successful requests to Tune MobileAppTracking Management API.}
84     \textcolor{comment}{#}
85     \textcolor{comment}{##}
86     \textcolor{comment}{# Run Example\(\backslash\)n}
87     \textcolor{keyword}{def }run(self, api\_key):
88 
89         \textcolor{comment}{# api\_key}
90         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} api\_key \textcolor{keywordflow}{or} len(api\_key) < 1:
91             \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Parameter 'api\_key' is not defined."})
92 
93         print(  \textcolor{stringliteral}{"===================================================="})
94         print(  \textcolor{stringliteral}{"= Tune Management API Advertiser Reports Cohort    ="})
95         print(  \textcolor{stringliteral}{"===================================================="})
96 
97         \textcolor{keywordflow}{try}:
98             week\_ago = datetime.date.fromordinal(datetime.date.today().toordinal()-8)
99             yesterday = datetime.date.fromordinal(datetime.date.today().toordinal()-1)
100             start\_date  = \textcolor{stringliteral}{"\{\} 00:00:00"}.format(week\_ago)
101             end\_date    = \textcolor{stringliteral}{"\{\} 23:59:59"}.format(yesterday)
102 
103             ltv = LTV(api\_key, validate = \textcolor{keyword}{True})
104             
105             response = ltv.fields()
106             print(\textcolor{stringliteral}{"= advertiser/stats/ltv fields: \{\}"}.format(response))
107 
108             print(  \textcolor{stringliteral}{"= advertiser/stats/ltv/count.json cohort click request ="})
109             response = ltv.count(
110                     start\_date,
111                     end\_date,
112                     cohort\_type         = \textcolor{stringliteral}{"click"},
113                     cohort\_interval     = \textcolor{stringliteral}{"year\_day"},
114                     group               = \textcolor{stringliteral}{"site\_id,campaign\_id,publisher\_id"},
115                     filter              = \textcolor{stringliteral}{"(publisher\_id > 0)"},
116                     response\_timezone   = \textcolor{stringliteral}{"America/Los\_Angeles"}
117                 )
118             print(\textcolor{stringliteral}{"= advertiser/stats/ltv/count.json response: \{\}"}.format(response))
119 
120             \textcolor{keywordflow}{if} response.http\_code != 200:
121                 \textcolor{keywordflow}{raise} \hyperlink{classException}{Exception}(\textcolor{stringliteral}{"Failed: \{\}: \{\}"}.format(response.http\_code, str(response.errors)))
122 
123             print(\textcolor{stringliteral}{"Count: \{\}\(\backslash\)n"}.format(response.data))
124 
125             print(  \textcolor{stringliteral}{"= advertiser/stats/ltv/count.json cohort install request ="})
126             response = ltv.count(
127                     start\_date,
128                     end\_date,
129                     cohort\_type         = \textcolor{stringliteral}{"install"},
130                     cohort\_interval     = \textcolor{stringliteral}{"year\_day"},
131                     group               = \textcolor{stringliteral}{"site\_id,campaign\_id,publisher\_id"},
132                     filter              = \textcolor{stringliteral}{"(publisher\_id > 0)"},
133                     response\_timezone   = \textcolor{stringliteral}{"America/Los\_Angeles"}
134                 )
135             print(\textcolor{stringliteral}{"= advertiser/stats/ltv/count.json response: \{\}"}.format(response))
136 
137             \textcolor{keywordflow}{if} response.http\_code != 200:
138                 \textcolor{keywordflow}{raise} \hyperlink{classException}{Exception}(\textcolor{stringliteral}{"Failed: \{\}: \{\}"}.format(response.http\_code, str(response.errors)))
139 
140             print(\textcolor{stringliteral}{"Count: \{\}\(\backslash\)n"}.format(response.data))
141 
142             print(  \textcolor{stringliteral}{"= advertiser/stats/ltv/find.json aggregate cumulative + cohort click request ="})
143             response = ltv.find(
144                     start\_date,
145                     end\_date,
146                     cohort\_type         = \textcolor{stringliteral}{"click"},
147                     aggregation\_type    = \textcolor{stringliteral}{"cumulative"},
148                     cohort\_interval     = \textcolor{stringliteral}{"year\_day"},
149                     group               = \textcolor{stringliteral}{"site\_id,campaign\_id,publisher\_id"},
150                     filter              = \textcolor{stringliteral}{"(publisher\_id > 0)"},
151                     fields              = \textcolor{stringliteral}{"site\_id,site.name,campaign\_id"} \(\backslash\)
152                         \textcolor{stringliteral}{",campaign.name,publisher\_id,publisher.name"} \(\backslash\)
153                         \textcolor{stringliteral}{",installs,events,purchases,opens,cpi,rpi,epi"} \(\backslash\)
154                         \textcolor{stringliteral}{",opi,currency\_code"},
155                     limit               = 5,
156                     page                = \textcolor{keywordtype}{None},
157                     sort                = \textcolor{keywordtype}{None},
158                     response\_timezone   = \textcolor{stringliteral}{"America/Los\_Angeles"}
159                 )
160             print(\textcolor{stringliteral}{"= advertiser/stats/ltv/find.json response: \{\}"}.format(response))
161 
162             \textcolor{keywordflow}{if} response.http\_code != 200:
163                 \textcolor{keywordflow}{raise} \hyperlink{classException}{Exception}(\textcolor{stringliteral}{"Failed: \{\}: \{\}"}.format(response.http\_code, str(response.errors)))
164 
165             print(  \textcolor{stringliteral}{"= advertiser/stats/ltv/export.json aggregate incremental + cohort click request ="})
166             response = ltv.find(
167                     start\_date,
168                     end\_date,
169                     cohort\_type         = \textcolor{stringliteral}{"click"},
170                     aggregation\_type    = \textcolor{stringliteral}{"incremental"},
171                     cohort\_interval     = \textcolor{stringliteral}{"year\_day"},
172                     group               = \textcolor{stringliteral}{"site\_id,campaign\_id,publisher\_id"},
173                     filter              = \textcolor{stringliteral}{"(publisher\_id > 0)"},
174                     fields              = \textcolor{stringliteral}{"site\_id,site.name,campaign\_id"} \(\backslash\)
175                         \textcolor{stringliteral}{",campaign.name,publisher\_id,publisher.name"} \(\backslash\)
176                         \textcolor{stringliteral}{",installs,events,purchases,opens,cpi,rpi,epi"} \(\backslash\)
177                         \textcolor{stringliteral}{",opi,currency\_code"},
178                     limit               = 5,
179                     page                = \textcolor{keywordtype}{None},
180                     sort                = \textcolor{keywordtype}{None}
181                 )
182             print(\textcolor{stringliteral}{"= advertiser/stats/ltv/find.json response: \{\}"}.format(response))
183 
184             \textcolor{keywordflow}{if} response.http\_code != 200:
185                 \textcolor{keywordflow}{raise} \hyperlink{classException}{Exception}(\textcolor{stringliteral}{"Failed: \{\}: \{\}"}.format(response.http\_code, str(response.errors)))
186 
187             print(  \textcolor{stringliteral}{"= advertiser/stats/ltv/export.json aggregate cumulative + cohort click request ="})
188             response = ltv.export(
189                     start\_date,
190                     end\_date,
191                     cohort\_type         = \textcolor{stringliteral}{"click"},
192                     aggregation\_type    = \textcolor{stringliteral}{"cumulative"},
193                     cohort\_interval     = \textcolor{stringliteral}{"year\_day"},
194                     group               = \textcolor{stringliteral}{"site\_id,campaign\_id,publisher\_id"},
195                     filter              = \textcolor{stringliteral}{"(publisher\_id > 0)"},
196                     fields              = \textcolor{stringliteral}{"site\_id,site.name,campaign\_id"} \(\backslash\)
197                         \textcolor{stringliteral}{",campaign.name,publisher\_id,publisher.name"} \(\backslash\)
198                         \textcolor{stringliteral}{",installs,events,purchases,opens,cpi,rpi,epi"} \(\backslash\)
199                         \textcolor{stringliteral}{",opi,currency\_code"},
200                     response\_timezone   = \textcolor{stringliteral}{"America/Los\_Angeles"}
201                 )
202             print(\textcolor{stringliteral}{"= advertiser/stats/ltv/export.json response: \{\}"}.format(response))
203 
204             \textcolor{keywordflow}{if} response.http\_code != 200:
205                 \textcolor{keywordflow}{raise} \hyperlink{classException}{Exception}(\textcolor{stringliteral}{"Failed: \{\}: \{\}"}.format(response.http\_code, str(response.errors)))
206 
207             job\_id = response.data[\textcolor{stringliteral}{"job\_id"}]
208             print(\textcolor{stringliteral}{"Job ID: \{\}"}.format(job\_id))
209 
210             print(  \textcolor{stringliteral}{"= advertiser stats ltv status in CSV data format ="})
211 
212             csv\_report\_reader = ltv.fetch(job\_id, report\_format=\textcolor{stringliteral}{"csv"}, verbose = \textcolor{keyword}{True})
213             csv\_report\_reader.read()
214             csv\_report\_reader.pretty\_print(limit=5)
215 
216             print(  \textcolor{stringliteral}{"= advertiser/stats/ltv/export.json aggregate incremental + cohort click request ="})
217             response = ltv.export(
218                     start\_date,
219                     end\_date,
220                     cohort\_type         = \textcolor{stringliteral}{"click"},
221                     aggregation\_type    = \textcolor{stringliteral}{"incremental"},
222                     cohort\_interval     = \textcolor{stringliteral}{"year\_day"},
223                     group               = \textcolor{stringliteral}{"site\_id,campaign\_id,publisher\_id"},
224                     filter              = \textcolor{stringliteral}{"(publisher\_id > 0)"},
225                     fields              = \textcolor{stringliteral}{"site\_id,site.name,campaign\_id"} \(\backslash\)
226                         \textcolor{stringliteral}{",campaign.name,publisher\_id,publisher.name"} \(\backslash\)
227                         \textcolor{stringliteral}{",installs,events,purchases,opens,cpi,rpi,epi"} \(\backslash\)
228                         \textcolor{stringliteral}{",opi,currency\_code"},
229                     response\_timezone   = \textcolor{stringliteral}{"America/Los\_Angeles"}
230                 )
231             print(\textcolor{stringliteral}{"= advertiser/stats/ltv/export.json response: \{\}"}.format(response))
232 
233             \textcolor{keywordflow}{if} response.http\_code != 200:
234                 \textcolor{keywordflow}{raise} \hyperlink{classException}{Exception}(\textcolor{stringliteral}{"Failed: \{\}: \{\}"}.format(response.http\_code, str(response.errors)))
235 
236             job\_id = response.data[\textcolor{stringliteral}{"job\_id"}]
237             print(\textcolor{stringliteral}{"Job ID: \{\}"}.format(job\_id))
238 
239             print(  \textcolor{stringliteral}{"= advertiser stats ltv status in CSV data format ="})
240 
241             csv\_report\_reader = ltv.fetch(job\_id, report\_format=\textcolor{stringliteral}{"csv"}, verbose = \textcolor{keyword}{True})
242             csv\_report\_reader.read()
243             csv\_report\_reader.pretty\_print(limit=5)
244 
245         \textcolor{keywordflow}{except} TuneSdkException \textcolor{keyword}{as} exc:
246             print(\textcolor{stringliteral}{"TuneSdkException (\{\})"}.format(exc))
247             print(self.format\_exception(exc.errors))
248             \textcolor{keywordflow}{raise}
249         \textcolor{keywordflow}{except} Exception:
250             exc\_type, exc\_value, exc\_traceback = sys.exc\_info()
251             print(\textcolor{stringliteral}{"*** print\_tb:"})
252             traceback.print\_tb(exc\_traceback, limit=1, file=sys.stdout)
253             print(\textcolor{stringliteral}{"*** print\_exception:"})
254             traceback.print\_exception(exc\_type, exc\_value, exc\_traceback,
255                                       limit=2, file=sys.stdout)
256             print(\textcolor{stringliteral}{"*** print\_exc:"})
257             traceback.print\_exc()
258             \textcolor{keywordflow}{raise}
259 
260         print(  \textcolor{stringliteral}{"======================================"})
261         print(  \textcolor{stringliteral}{"= End Example                        ="})
262         print(  \textcolor{stringliteral}{"======================================"})
263 
264     @staticmethod
265     \textcolor{keyword}{def }format\_exception(e):
266         \textcolor{stringliteral}{"Provide traceback of provided exception."}
267         exception\_list = traceback.format\_stack()
268         exception\_list = exception\_list[:-2]
269         exception\_list.extend(traceback.format\_tb(sys.exc\_info()[2]))
270         exception\_list.extend(traceback.format\_exception\_only(sys.exc\_info()[0], sys.exc\_info()[1]))
271 
272         exception\_str = \textcolor{stringliteral}{"Traceback (most recent call last):\(\backslash\)n"}
273         exception\_str += \textcolor{stringliteral}{""}.join(exception\_list)
274         \textcolor{comment}{# Removing the last \(\backslash\)n}
275         exception\_str = exception\_str[:-1]
276 
277         \textcolor{keywordflow}{return} exception\_str
278 
279 \textcolor{keywordflow}{if} \_\_name\_\_ == \textcolor{stringliteral}{'\_\_main\_\_'}:
280     \textcolor{keywordflow}{try}:
281         \textcolor{keywordflow}{if} len(sys.argv) < 2:
282             \textcolor{keywordflow}{raise} ValueError(\textcolor{stringliteral}{"Provide API Key to execute Tune Management API example \{\}."}.format(sys.argv[0
      ]))
283         api\_key = sys.argv[1]
284         example = ExampleCohort()
285         example.run(api\_key)
286     \textcolor{keywordflow}{except} Exception \textcolor{keyword}{as} exc:
287         print(\textcolor{stringliteral}{"Exception: \{0\}"}.format(exc))
288         \textcolor{keywordflow}{raise}
\end{DoxyCodeInclude}
 